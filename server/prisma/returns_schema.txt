enum RefundMethod {
  CASH
  TRANSFER
}

enum ReturnStatus {
  APPROVED
  COMPLETED
}

enum ItemCondition {
  NEW
  OPENED
  DAMAGED
}

model SalesReturn {
  id                String              @id @default(uuid())
  returnNumber      String              @unique @map("return_number")
  
  // Relations
  transactionId     String              @map("transaction_id")
  transaction       Transaction         @relation(fields: [transactionId], references: [id])
  
  // Return Info
  returnDate        DateTime            @default(now()) @map("return_date")
  reason            String
  notes             String?
  
  // Financial
  refundAmount      Decimal             @db.Decimal(12, 2) @map("refund_amount")
  refundMethod      RefundMethod        @map("refund_method")
  
  // Status
  status            ReturnStatus        @default(APPROVED)
  
  // User
  userId            String              @map("user_id")
  user              User                @relation(fields: [userId], references: [id])
  
  items             SalesReturnItem[]
  
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")

  @@map("sales_returns")
}

model SalesReturnItem {
  id              String        @id @default(uuid())
  salesReturnId   String        @map("sales_return_id")
  salesReturn     SalesReturn   @relation(fields: [salesReturnId], references: [id], onDelete: Cascade)
  
  productId       String        @map("product_id")
  product         Product       @relation(fields: [productId], references: [id])
  
  quantity        Int
  unitPrice       Decimal       @db.Decimal(12, 2) @map("unit_price")
  subtotal        Decimal       @db.Decimal(12, 2)
  reason          String?
  condition       ItemCondition

  @@map("sales_return_items")
}

model PurchaseReturn {
  id                String                @id @default(uuid())
  returnNumber      String                @unique @map("return_number")
  
  // Relations
  purchaseOrderId   String                @map("purchase_order_id")
  purchaseOrder     PurchaseOrder         @relation(fields: [purchaseOrderId], references: [id])
  supplierId        String                @map("supplier_id")
  supplier          Supplier              @relation(fields: [supplierId], references: [id])
  
  // Return Info
  returnDate        DateTime              @default(now()) @map("return_date")
  reason            String
  notes             String?
  
  // Financial
  returnAmount      Decimal               @db.Decimal(12, 2) @map("return_amount")
  refundReceived    Boolean               @default(false) @map("refund_received")
  refundDate        DateTime?             @map("refund_date")
  
  // User
  userId            String                @map("user_id")
  user              User                  @relation(fields: [userId], references: [id])
  
  items             PurchaseReturnItem[]
  
  createdAt         DateTime              @default(now()) @map("created_at")
  updatedAt         DateTime              @updatedAt @map("updated_at")

  @@map("purchase_returns")
}

model PurchaseReturnItem {
  id                String          @id @default(uuid())
  purchaseReturnId  String          @map("purchase_return_id")
  purchaseReturn    PurchaseReturn  @relation(fields: [purchaseReturnId], references: [id], onDelete: Cascade)
  
  productId         String          @map("product_id")
  product           Product         @relation(fields: [productId], references: [id])
  
  quantity          Int
  unitPrice         Decimal         @db.Decimal(12, 2) @map("unit_price")
  subtotal          Decimal         @db.Decimal(12, 2)
  reason            String?
  condition         ItemCondition

  @@map("purchase_return_items")
}
